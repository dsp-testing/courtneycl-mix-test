<!DOCTYPE html>
<html
  lang="<%= HygeiaCldr.get_locale().cldr_locale_name %>"
  data-sentry-dsn="<%= Sentry.Config.dsn() %>"
  data-sentry-user="<%= Jason.encode!(case get_auth(@conn) do
    :anonymous -> %{}
    %{uuid: id, email: email, display_name: name} -> %{id: id, email: email, name: name}
  end) %>"
>
 <!-- Sentry.setUser({ email: "john.doe@example.com" });-->
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <%= csrf_meta_tag() %>
    <%= live_title_tag assigns[:page_title] || "Hygeia" %>
    <link
      phx-track-static
      rel="stylesheet"
      href="<%= Routes.static_path(@conn, "/css/app.css") %>"
      integrity="<%= integrity_hash(Routes.static_path(@conn, "/css/app.css")) %>"
      nonce="<%= nonce(@conn, :style) %>"
    />
    <script type="text/javascript" nonce="<%= nonce(@conn, :script) %>">
      __webpack_nonce__ = <%= @conn |> nonce(:script) |> Jason.encode! |> raw %>;
    </script>
    <script
      defer
      phx-track-static
      type="text/javascript"
      src="<%= Routes.static_path(@conn, "/js/app.js") %>"
      integrity="<%= integrity_hash(Routes.static_path(@conn, "/css/app.js")) %>"
      nonce="<%= nonce(@conn, :script) %>"
      crossorigin="anonymous"
    ></script>

    <meta name="hygeia-translations" content="<%=
      [
        gettext_noop("Do you really want to continue without saving?")
      ]
      |> Map.new(&({&1, Gettext.gettext(HygeiaGettext, &1)}))
      |> Jason.encode!()
    %>" />
  </head>
  <body class="layout-root">
    <div class="system-messages">
      <%= for msg <- Hygeia.SystemMessageContext.list_active_system_messages(get_auth(@conn)) do %>
        <div class="alert alert-info m-0 d-flex align-items-center rounded-0">
          <h5 class="oi oi-info mb-0 mr-4" aria-hidden="true"></h5>
          <div class="">
            <%= raw(Earmark.as_html!(msg)) %>
          </div>
        </div>
      <% end %>
    </div>
    <%= @inner_content %>
  </body>
</html>
